@model IEnumerable<Vaago.Models.Account>

@{
    ViewBag.Title = "AdminCustomers";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<section>
    <div>
        <span class="page-title">CUSTOMERS</span>
        <hr />
    </div>
    <div class="maincard-cont">
        <div style="text-align: start; width: 95%">
            <button class="btn btn-danger delete-button">Delete Customer</button>
        </div>
        <hr class="thin-hr" />
        <div class="table-div">
            <table class="table table-striped admintable">
                <thead class="bg-dark text-white">
                    <tr>
                        <th><input type="checkbox" /></th>
                        <th>Account ID</th>
                        <th>NAME</th>
                        <th>EMAIL</th>
                        <th>PHONE</th>
                        <th>LOCATION</th>
                        <th>Role</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model == null)
                    {
                        <tr></tr>
                    }
                    else
                    {
                        foreach (var item in Model)
                        {
                            <tr>
                                <td style="vertical-align: bottom;">
                                    <label class="checkbox-container">
                                        <input type="checkbox" class="delete-checkbox" data-customerid="@item.account_ID" />
                                        <span class="checkmark"></span>
                                    </label>
                                </td>
                                <td>@item.account_ID</td>
                                <td>@item.name</td>
                                <td>@item.email</td>
                                <td>@item.phone</td>
                                <td>@item.location</td>
                                <td>User</td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
</section>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        // AJAX DELETE REQUEST
        $(".delete-button").click(function () {
            var itemsToDelete = [];

            // Iterate over the checked checkboxes and collect the customer IDs
            $(".delete-checkbox:checked").each(function () {
                var ccustomerID = $(this).data("customerid");
                console.log("customerID: " + ccustomerID); // Debugging statement
                itemsToDelete.push(parseInt(ccustomerID));
            });

            console.log("itemsToDelete: ", itemsToDelete); // Debugging statement

            if (itemsToDelete.length > 0) {
                // Send the AJAX request to delete the selected customers
                $.ajax({
                    url: '@Url.Action("DeleteCustomer", "AdminCustomers")',
                    type: 'POST',
                    dataType: 'json',
                    data: JSON.stringify({ customerID: itemsToDelete }),
                    contentType: 'application/json',
                    success: function (response) {
                        if (response.success) {
                            // Handle success, such as displaying a success message or refreshing the data grid
                            alert("Customers deleted successfully.");
                            location.reload();
                            // Refresh the data grid view or perform any other necessary actions
                        } else {
                            // Handle error, such as displaying an error message
                            alert("An error occurred while deleting customersss.");
                        }
                    },
                    error: function () {
                        // Handle error, such as displaying an error message
                        alert("An error occurred while deleting customers.");
                    },
                    complete: function () {
                        console.log(itemsToDelete);
                    }
                });
            } else {
                alert("Please select customers to delete.");
            }
        });
    });
</script>



<style>
    .table-div {
        overflow: hidden;
        width: 100%;
        margin-left: -10px;
        padding-right: 30px;
    }

    .checkbox-container {
        display: block;
        position: relative;
        padding-left: 25px;
        margin-bottom: 12px;
        cursor: pointer;
        font-size: 18px;
        user-select: none;
    }

        .checkbox-container input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }

    .checkmark {
        position: absolute;
        top: -10px;
        left: 10px;
        height: 18px;
        width: 18px;
        background-color: #eee;
    }

    .checkbox-container:hover input ~ .checkmark {
        background-color: #ccc;
    }

    .checkbox-container input:checked ~ .checkmark {
        background-color: #2196F3;
    }

    .checkmark:after {
        content: "";
        position: absolute;
        display: none;
    }

    .checkbox-container input:checked ~ .checkmark:after {
        display: block;
    }

    .checkbox-container .checkmark:after {
        left: 6px;
        top: 2px;
        width: 5px;
        height: 10px;
        border: solid white;
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
    }
</style>


